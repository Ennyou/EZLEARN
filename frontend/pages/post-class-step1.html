<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="../imgs/favicon.ico" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="../css/postClass.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <title>Document</title>
    <script src="../js/postClass.js"></script>
  </head>

  <body>
    <div id="navbar"></div>

    <!-- 主頁面 -->
    <div class="flex flex-col items-center p-8" id="allContent">
      <div>
        <div class="progressbar">
          <div class="progress" id="progress"></div>
          <div class="progress-step active"></div>
          <div class="progress-step"></div>
          <div class="progress-step"></div>
        </div>
      </div>

      <div class="bg-gray-100 bg-opacity-80 w-[70vw] rounded-2xl" id="content">
        <form class="grid grid-cols-3 sm: md:mx-[10%] my-[5%]">
          <h5 class="text-3xl font-semibold text-gray-900 col-span-3 mx-3">
            歡迎來到我們的線上課程設置平台！
          </h5>
          <p class="mt-1 text-2xl text-gray-600 col-span-3 mx-3">
            在這裡，您可以輕鬆設置並管理您的線上課程，讓學員們在您的精心設計下學習新知識。我們提供簡單且直觀的工具，幫助您根據需要創建、調整和發佈課程內容。無論您是要開始一門新的課程，或是更新現有課程，都能在幾分鐘內完成，並與學員共享您寶貴的學習資料。
            讓我們一起打造一個充滿創新、互動和學習樂趣的線上學習環境，提升學生的學習體驗，並加速您知識的傳播！
          </p>

          <div class="mt-10 col-span-3 grid grid-cols-3 gap-x-6 gap-y-8 mx-3">
            <div class="col-span-full grid grid-cols-3">
              <label
                for="coursename"
                class="block text-3xl text-gray-900 col-span-3"
                >課程名稱</label
              >
              <div class="mt-2 col-span-3">
                <div
                  class="flex items-center rounded-md bg-white pl-3 outline outline-1 -outline-offset-1 outline-gray-300 focus-within:outline focus-within:outline-2 focus-within:-outline-offset-2 focus-within:outline-black"
                >
                  <input
                    type="text"
                    name="coursename"
                    id="coursename"
                    class="block min-w-0 grow py-1.5 pl-1 pr-3 text-2xl text-gray-900 focus:outline focus:outline-0"
                    autocomplete="off"
                    placeholder="java2週速成班"
                  />
                </div>
              </div>
            </div>

            <div class="col-span-full">
              <label for="username" class="block text-3xl text-gray-900"
                >課程主題</label
              >
              <div class="mt-2">
                <div
                  class="flex items-center rounded-md bg-white pl-3 outline outline-1 -outline-offset-1 outline-gray-300 focus-within:outline focus-within:outline-2 focus-within:-outline-offset-2 focus-within:outline-black"
                >
                  <select
                    class="text-2xl block min-w-0 grow py-1.5 pl-1 pr-3 focus:outline focus:outline-0"
                    id="courseClass"
                    name="courseClass"
                    value="大眾傳播"
                  >
                    <option value="" disabled selected>請選擇主題</option>
                    <!-- 這裡是佔位符 -->
                    <option>語言學習</option>
                    <option>程式設計</option>
                    <option>美食料理</option>
                    <option>藝術創作</option>
                    <option>運動健身</option>
                    <option>理財投資</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="col-span-full">
              <label for="coursePrice" class="block text-3xl text-gray-900"
                >課程價格</label
              >
              <div class="mt-2">
                <div
                  class="flex items-center rounded-md bg-white pl-3 outline outline-1 -outline-offset-1 outline-gray-300 focus-within:outline focus-within:outline-2 focus-within:-outline-offset-2 focus-within:outline-black"
                >
                  <input
                    type="number"
                    min="0"
                    max="2147483647"
                    title="只能輸入大於0小於2147483647的數字"
                    name="coursePrice"
                    id="coursePrice"
                    class="block min-w-0 grow py-1.5 pl-1 pr-3 text-2xl text-gray-900 focus:outline focus:outline-0"
                    placeholder="9999"
                  />
                </div>
              </div>
            </div>

            <div class="col-span-full">
              <label for="courseIntro" class="block text-3xl text-gray-900"
                >課程介紹</label
              >
              <div class="mt-2">
                <textarea
                  name="courseIntro"
                  id="courseIntro"
                  rows="3"
                  class="block w-full rounded-md bg-white px-3 py-1.5 text-2xl text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 focus:outline focus:outline-2 focus:-outline-offset-2 focus-within:outline-black"
                  placeholder="請輸入課程介紹"
                >
                </textarea>
              </div>
              <p class="mt-3 text-2xl text-gray-600">
                請描述所上之課程的簡介(建議不要超過50個字，讓學生們一看就明白)
              </p>
            </div>
            <div class="col-span-full">
              <label for="courseSummary" class="block text-3xl text-gray-900"
                >課程總覽
              </label>
              <div class="mt-2">
                <textarea
                  name="courseSummary"
                  id="courseSummary"
                  rows="3"
                  class="block w-full rounded-md bg-white px-3 py-1.5 text-2xl text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 focus:outline focus:outline-2 focus:-outline-offset-2 focus-within:outline-black"
                >
                </textarea>
              </div>
              <p class="mt-3 text-2xl text-gray-600">
                請針對課程的內容詳細描述(如果內容繁多可以點擊輸入框右下角進行輸入框大小調整)
              </p>
            </div>

            <div class="col-span-3 grid grid-cols-3 gap-y-6">
              <!-- flex -->
              <div
                class="col-span-3 grid grid-cols-3 sm:col-span-3 md:col-span-2 lg:col-span-1"
              >
                <label class="col-span-3 block text-3xl text-gray-900"
                  >課程封面</label
                >
                <!-- 上傳封面框 -->
                <div class="col-span-3 text-center" id="oringImage">
                  <label
                    for="courseImage"
                    class="border border-gray-900/25 cursor-pointer rounded-md bg-white font-semibold text-black text-3xl"
                    >上傳課程封面照
                    <input
                      id="courseImage"
                      name="courseImage"
                      type="file"
                      accept=".jpg, .jpeg, .png"
                      class="sr-only"
                    />
                  </label>
                </div>
                <div class="mt-2 col-span-3">
                  <p class="text-xl mt-1 sm:text-xl md:text-2xl">
                    建議照片比例為 336 : 250，
                  </p>

                  <p class="text-xl mt-1 sm:text-xl md:text-2xl">
                    檔案格式僅支援 jpg, png
                  </p>
                </div>
              </div>
              <!-- 間格的虛線 -->
              <div
                class="hidden border-l border-l-dashed border-gray-900/25 border-black h-[250px] mx-[50%] md:col-span-1 sm:col-span-3 sm:hidden lg:block"
              ></div>
              <!-- 草稿框 -->
              <div
                class="w-[223.25px] h-[124px] ml-4 overflow-hidden rounded-lg border border-dashed border-gray-900/25 bg-white/50 sm:col-span-3 md:col-span-3 lg:col-span-1 mt-10"
              >
                <img id="displayZone" class="w-full h-full object-cover" />
              </div>
            </div>
          </div>
          <div class="mt-6 flex items-center justify-end gap-x-6 col-span-4">
            <button
              type="button"
              class="rounded-md px-3 py-2 lg:text-xl font-semibold text-white shadow-sm bg-gray hover:bg-black-100"
              style="background-color: #7c807c"
              onclick="step2()"
              id="nextToTwo"
            >
              下一步
            </button>
          </div>
        </form>
      </div>
    </div>
    <div id="footer"></div>
    <img class="hidden xl:inline-block" src="../imgs/indexBg1.png" id="bg1" />
    <img src="../imgs/indexBg2.png" id="bg2" />
    <script src="../js/header-footer.js"></script>
    <script>
      $("#coursename").click(function () {
        console.log("點擊正常");
      });
      $("#coursePrice").on("input", (event) => {
        let value = event.target.value;

        // 移除所有非數字字符（包括 `+` 和 `-`）
        value = value.replace(/[^0-9]/g, "");

        // 更新輸入框的值
        event.target.value = value;

        // 限制最大值
        const numericValue = parseInt(value, 10);
        if (numericValue > 2147483647) {
          event.target.value = 2147483647; // 自動調整為最大值
          alert("金額不能超過 2147483647");
          handleBlur("#coursePrice", "savecourseprice", "coursePrice");
        }
      });

      $("#courseImage").on("change", function () {
        const file = this.files[0]; // 修正錯誤
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            // 更新圖片預覽區域
            $("#displayZone").attr("src", e.target.result);
            $("#previewText").addClass("hidden");
            fetch("http://10.0.104.199:8080/orders10/test22", {
              method: "POST",
              headers: {
                "Content-Type": "application/json", // 設置為 JSON 格式
              },
              body: JSON.stringify({ courseImage: e.target.result }),
            })
              .then((response) => {
                if (!response.ok)
                  throw new Error("HTTP status " + response.status);
                return response.text();
              })
              .then((data) => console.log("圖片暫存成功：", data))
              .catch((error) => console.error("圖片暫存失敗：", error));
          };
          reader.readAsDataURL(file);
        }
      });

      function handleBlur(inputSelector, endpoint, dataKey) {
        $(inputSelector).on("change", function () {
          const inputValue = $(inputSelector).val(); // 獲取輸入框的值

          // 使用 fetch 發送 POST 請求
          fetch(`http://10.0.104.199:8080/orders10/${endpoint}`, {
            method: "POST",
            credentials: "include",
            headers: {
              "Content-Type": "application/json", // 設置為 JSON 格式
            },
            body: JSON.stringify({ [dataKey]: inputValue }), // 動態設定鍵和值
          })
            .then((response) => {
              if (!response.ok)
                throw new Error("HTTP status " + response.status);
              return response.text();
            })
            .then((data) => console.log(`${dataKey} 暫存成功：`, data))
            .catch((error) => console.error(`${dataKey} 暫存失敗：`, error));
        });
      }

      // 對不同輸入框添加事件
      handleBlur("#coursename", "test10", "coursename");
      handleBlur("#courseClass", "test13", "courseClass");
      handleBlur("#coursePrice", "savecourseprice", "coursePrice");
      handleBlur("#courseIntro", "test20", "courseIntro");
      handleBlur("#courseSummary", "savecoursesummary", "courseSummary");

      //重新整理
      document.addEventListener(
        "DOMContentLoaded",
        function () {
          if (!window.initialized) {
            window.initialized = true; // 標記腳本已初始化
            formStepsNum = 0; // 初始化變數
          }
          loadName("#coursename", "test11");
          loadName("#courseClass", "test14");
          loadName("#courseIntro", "test21");
          loadName("#courseSummary", "loadcoursesummary");
          loadName("#coursePrice", "loadcourseprice");

          loadImage();
        }

        // 其他邏輯
      );

      fetch("../components/navbar.html")
        .then((response) => response.text())
        .then((data) => {
          $("#navbar").html(data);
        });

      fetch("../components/footer.html")
        .then((response) => response.text())
        .then((data) => {
          $("#footer").html(data);
        });

      $(document).ready(checkIsLogin);
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  </body>
</html>
